var bgVbo;var bgProgram;var BG_SIZE=512;function bgInit(){var b=new Float32Array([0,0,0,1,BG_SIZE,0,1,1,0,BG_SIZE,0,0,BG_SIZE,BG_SIZE,1,0,]);bgVbo=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,bgVbo);gl.bufferData(gl.ARRAY_BUFFER,b,gl.STATIC_DRAW);bgProgram=new esProgram(gl);bgProgram.addShaderId("bg-fs",ES_FRAGMENT);bgProgram.addShaderId("bg-vs",ES_VERTEX);bgProgram.link();bgProgram.use();var a=bgProgram.getUniform("mvp");var d=bgProgram.getUniform("tex");var c=esMat4_create();esMat4_ortho(c,0,0,640,512);gl.uniformMatrix4fv(a,false,c);gl.uniform1i(d,0)}function bgRender(){bgProgram.use();gl.enableVertexAttribArray(0);gl.bindBuffer(gl.ARRAY_BUFFER,bgVbo);gl.vertexAttribPointer(0,4,gl.FLOAT,false,0,0);gl.drawArrays(gl.TRIANGLE_STRIP,0,4);gl.disableVertexAttribArray(0)}var gl;var imgBg;var frameFunc;var texBg;function frameExec(a){if(frameFunc!=null){frameFunc(a)}}function makeTexture(b){var a=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,a);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,b);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);assert(a!=null,a);return a}function loaded(){bgInit();texBg=makeTexture(imgBg);frameFunc=playFrame;esNextFrame(frameExec)}function main(){frameFunc=null;gl=esInitGl("can");gl.clearColor(0,0,0,1);gl.clear(gl.COLOR_BUFFER_BIT);var a=new esLoad();imgBg=a.loadImage("bg.png");a.download(loaded)}function assert(a,b){if(!a){alert(b);throw new Error(a,b)}}function playFrame(a){gl.clear(gl.COLOR_BUFFER_BIT);bgRender()};